<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AcadTrack Admin Activities</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
body { display:flex; min-height:100vh; background-color:#f4f6f9; color:#333; transition:0.3s ease-in-out; }

/* Sidebar */
.sidebar { width:250px; background:#1e3a8a; color:white; display:flex; flex-direction:column; padding:20px; position:fixed; height:100%; box-shadow:2px 0 10px rgba(0,0,0,0.2);}
.sidebar h2 { text-align:center; margin-bottom:30px; font-size:22px; letter-spacing:1px; }
.sidebar a { text-decoration:none; color:pink; padding:12px 15px; border-radius:10px; margin-bottom:10px; display:block; transition:0.3s;}
.sidebar a:hover, .sidebar a.active { background:#2563eb; }

/* Main content */
.main { margin-left:260px; padding:20px 40px; width:100%; transition:0.3s; }
.topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
.topbar h1 { font-size:24px; font-weight:600; }

.card { background:lightseagreen; padding:20px; border-radius:16px; box-shadow:0 2px 10px rgba(0,0,0,0.1); margin-bottom:20px; transition:transform 0.2s ease; }
.card:hover { transform:translateY(-5px); }

table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #ccc; padding:10px; text-align:left; }
input, button { padding:8px; margin:5px 0; }
button { cursor:pointer; }
.edit-btn { background:#4CAF50; color:white; border:none; padding:5px 10px; border-radius:5px; }
.delete-btn { background:#f44336; color:white; border:none; padding:5px 10px; border-radius:5px; }

/* Quick Stats */
.stats { display:flex; gap:20px; margin-bottom:20px; }
.stats .stat { flex:1; padding:20px; border-radius:16px; text-align:center; color:white; }
.stats .total { background:#2563eb; }
.stats .upcoming { background:#fbbf24; color:#92400e; }
.stats .overdue { background:#ef4444; }

/* Highlight upcoming activity */
.upcoming-row { background:#fffbeb; }
.overdue-row { background:#fee2e2; }

.fade { animation:fadeIn 0.5s ease-in-out; }
@keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
</style>
</head>
<body>

<div class="sidebar">
  <h2>AcadTrack Admin</h2>
  <a href="dashboard.html" class="active"><i>üè†</i> Dashboard</a>
  <a href="calendar.html"><i>üìÖ</i> Calendar</a>
  <a href="manage_activities.html"><i>üìù</i> Activities</a>
  <a href="reports.html"><i>üìÇ</i> Reports</a>
  <a href="students.html"><i>üë•</i> Students</a>
  <a href="../logout.html"><i>üîì</i> Logout</a>
</div>

<div class="main fade">
<div class="topbar">
<h1>Activities</h1>
<p>Welcome, Admin üëã</p>
</div>

<!-- Quick Stats -->
<div class="stats">
  <div class="stat total">
    <h3>Total Activities</h3>
    <p id="totalActivities">0</p>
  </div>
  <div class="stat upcoming">
    <h3>Upcoming (7 days)</h3>
    <p id="upcomingActivities">0</p>
  </div>
  <div class="stat overdue">
    <h3>Overdue</h3>
    <p id="overdueActivities">0</p>
  </div>
</div>

<!-- Add/Edit Form -->
<div class="card">
<h3>Add / Edit Activity</h3>
<form id="activityForm">
<input type="hidden" id="id">
<input type="text" id="name" placeholder="Activity Name" required>
<input type="text" id="desc" placeholder="Description" required>
<input type="date" id="date" required>
<button type="submit">Save Activity</button>
</form>
</div>

<!-- Search & Table -->
<div class="card">
<h3>Search Activities</h3>
<input type="text" id="searchInput" placeholder="Search activities...">
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Description</th>
<th>Date</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="activityTableBody"></tbody>
</table>
</div>

<!-- Monthly Activities Chart -->
<div class="card">
<h3>Monthly Activities</h3>
<canvas id="monthlyChart" height="100"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let activities = JSON.parse(localStorage.getItem('activities') || '[]');

function saveToStorage(){ localStorage.setItem('activities', JSON.stringify(activities)); }

function updateStats(){
    const today = new Date();
    let upcoming=0, overdue=0;
    activities.forEach(a=>{
        const actDate = new Date(a.date);
        const diff = (actDate - today)/(1000*60*60*24);
        if(diff>=0 && diff<=7) upcoming++;
        if(diff<0) overdue++;
    });
    document.getElementById('totalActivities').textContent = activities.length;
    document.getElementById('upcomingActivities').textContent = upcoming;
    document.getElementById('overdueActivities').textContent = overdue;
}

function renderTable(search=''){
    const tbody=document.getElementById('activityTableBody');
    tbody.innerHTML='';
    const today = new Date();
    let filtered=activities.filter(a =>
        a.name.toLowerCase().includes(search.toLowerCase()) ||
        a.desc.toLowerCase().includes(search.toLowerCase())
    );
    if(filtered.length===0){ tbody.innerHTML='<tr><td colspan="5" style="text-align:center;">No activities found</td></tr>'; return; }

    filtered.forEach((a,index)=>{
        const actDate=new Date(a.date);
        let rowClass='';
        if((actDate - today)/(1000*60*60*24) >=0 && (actDate - today)/(1000*60*60*24)<=7) rowClass='upcoming-row';
        else if((actDate - today)/(1000*60*60*24)<0) rowClass='overdue-row';
        tbody.innerHTML+=`<tr class="${rowClass}">
        <td>${index+1}</td>
        <td>${a.name}</td>
        <td>${a.desc}</td>
        <td>${a.date}</td>
        <td>
        <button class="edit-btn" onclick="editActivity(${index})">Edit</button>
        <button class="delete-btn" onclick="deleteActivity(${index})">Delete</button>
        </td>
        </tr>`;
    });
    updateStats();
    renderMonthlyChart();
}

function editActivity(index){
    const a=activities[index];
    document.getElementById('id').value=index;
    document.getElementById('name').value=a.name;
    document.getElementById('desc').value=a.desc;
    document.getElementById('date').value=a.date;
}

function deleteActivity(index){
    if(confirm("Delete this activity?")){
        activities.splice(index,1);
        saveToStorage();
        renderTable(document.getElementById('searchInput').value);
    }
}

document.getElementById('activityForm').addEventListener('submit',function(e){
    e.preventDefault();
    const id=document.getElementById('id').value;
    const name=document.getElementById('name').value;
    const desc=document.getElementById('desc').value;
    const date=document.getElementById('date').value;

    if(id===''){ activities.push({name,desc,date}); }
    else{ activities[id]={name,desc,date}; }

    saveToStorage();
    renderTable(document.getElementById('searchInput').value);
    this.reset();
    document.getElementById('id').value='';
});

document.getElementById('searchInput').addEventListener('input',function(){
    renderTable(this.value);
});

// Chart.js Monthly Chart
function getMonthlyData(){
    const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    let data = new Array(12).fill(0);
    activities.forEach(a=>{
        const month = new Date(a.date).getMonth();
        data[month]++;
    });
    return { labels: months, data: data };
}

let monthlyChart;
function renderMonthlyChart(){
    const ctx = document.getElementById('monthlyChart').getContext('2d');
    const monthlyData = getMonthlyData();
    if(monthlyChart) monthlyChart.destroy();
    monthlyChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: monthlyData.labels,
            datasets: [{
                label: 'Activities',
                data: monthlyData.data,
                backgroundColor: '#2563eb'
            }]
        },
        options: {
            responsive:true,
            plugins: { legend:{ display:false }, tooltip:{enabled:true} },
            scales:{ y:{ beginAtZero:true, stepSize:1 } }
        }
    });
}

renderTable();
</script>
</body>
</html>
